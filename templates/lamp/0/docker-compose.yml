# Php & Apache

data:
  image: ubuntu
  labels:
    io.rancher.container.start_once: 'true'
  entrypoint:
    - /bin/true
  volumes:
    - /var/www/html
    - /var/lib/mysql
    - /data # used by redis

web:
  image: php:5.6-apache
  hostname: ${web_hostname}
  tty: true
  links:
    - db_mysql:mysql
    - redis:redis
  volumes-from:
    - data
  environment:
    REDIS_HOST: redis
    MYSQL_HOST: mysql
    MYSQL_DATABASE: ${sql_db}
    MYSQL_USER: ${sql_user}
    MYSQL_PASSWORD: ${sql_pass}
  expose:
    - "80"

# redis
redis:
  image: redis
  volumes-from:
    - data

# phpMyAdmin
phpmyadmin:
  image: nazarpc/phpmyadmin
  environment:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_HOST: mysql
  links:
    - db_mysql:mysql
  expose:
    - "80"

# MySql
db_mysql:
  image: mariadb
  volumes-from:
    - data
  expose:
    - "3306"
  environment:
    MYSQL_ROOT_PASSWORD: "root"
    MYSQL_DATABASE: project
    MYSQL_USER: project_user
    MYSQL_PASSWORD: ThisShouldBeKindOfSecretYouKnow
